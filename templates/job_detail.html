{% extends "base_generic.html" %}

{% block content %}

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.min.js"></script>
<script src="/static/scripts/d3.v3.min.js"></script>
<script src="/static/scripts/radialBarChart.js"></script>
    <script src="/static/scripts/HorizontalBarPlugin.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">


  <h1>Job: {{ job.job_name }}</h1>
    <p><strong>User:</strong> {{ job.user_name }}</p>
    <p><strong>Repository:</strong> {{ job.repository }}</p>
    <p><strong>Revision:</strong> {{ job.revision }}</p>
    <p><strong>Branch:</strong> {{ job.branch }}</p>
    <p><strong>Submitted:</strong>{{ job.submitted }}</p>
    <p><strong>Start Date:</strong>{{ job.start_date }}</p>
    <p><strong>Stop Date:</strong> {{ job.stop_date }}</p>
    <p><strong>MPI Ranks:</strong> {{ job.n_mpi_ranks }}</p>
    <p><strong>OMP Threads:</strong> {{ job.n_omp_threads }}</p>
    <p><strong>Simulated Time:</strong> {{ simulated_time }} years/day</p>
<div class="dropdown" style="display: inline-block">
<button onclick="ToggleDropDown('myDropdown')" class="dropbtn">Choose chart type <i class="fa fa-caret-down"></i></button>
  <div id="myDropdown" class="dropdown-content">
        <button onclick="changeBar('horizontalBar')" class="button dropdownbutton">Horizontal bar</button>
        <button onclick="changeBar('bar')" class="button dropdownbutton">Vertical bar</button>
        <button onclick="changeBar('RadialBar')" class="button dropdownbutton">Radial bar</button>
        <button onclick="changeBar('pie')" class="button dropdownbutton">Pie chart</button>
  </div>
</div>
    <button onclick="HideLabel('model_init')" class="button">Hide model Init</button>
    <div class="dropdown" style="display: inline-block">
<button onclick="ToggleDropDown('myDropdown2')" class="dropbtn">Compare with other job <i class="fa fa-caret-down"></i></button>
  <div id="myDropdown2" class="dropdown-content">
          {% for jobi in joblist %}
              {% if jobi != job %}
                 <a href="/monitor/compare/?job1={{job.job_name}}&job2={{jobi.job_name}}" > {{jobi.job_name}}</a>
              {% endif %}
        {% endfor %}
  </div>
</div>
     <canvas id="myChart" width="250" height="250"></canvas>
     <div id="chart"></div>




<script>
var chart = document.getElementById('chart');
chart.onclick = function (evt) {

};
/* When the user clicks on the button,
toggle between hiding and showing the dropdown content */
function ToggleDropDown(dropdown) {
    document.getElementById(dropdown).classList.toggle("show");
}
var radialBar = 'false';
var ctx = document.getElementById("myChart").getContext('2d');
var color = Chart.helpers.color;
var data = {
        labels: {{ timer_names|safe }},
        datasets: [{
            type:'line',
            label: 'max',
            data: {{ max }},
            backgroundColor:'rgba(255,0,0, 0.2)',
            borderColor:"#000000",
            borderWidth: 1,
                                          fill: false,
                    showLine: false,
        }, {
            label: 'avg',
            data: {{ avg }},
            backgroundColor:'rgba(0,255,0, 0.2)' ,
            borderColor:"#000000" ,
            borderWidth: 1
        },{
            type:'line',
            fill: false,
            showLine: false,
            label: 'min',
            data: {{ min }},
            backgroundColor: 'rgba(0,0,255, 0.2)',
            borderColor: "#000000",
            borderWidth: 1
        }]
    }
  var myChart;

changeBar('horizontalBar');

var canvas = document.getElementById('myChart');
canvas.onclick = function (evt) {
    activePoints = myChart.getElementAtEvent(evt);
    if (activePoints.length > 0 ) {
        var chartData = activePoints[0]['_chart'].config.data;
        var idx = activePoints[0]['_index'];
        var label = chartData.labels[idx];
        window.location.href = "/monitor/timer/" + label + "/?job=" +{{ job.job_name }};
    }
};


function HideLabel(name){
    console.log(myChart)
    myChart.config.data.labels[0].hidden = true
    myChart.update()
}


/* When the user clicks on the button,
toggle between hiding and showing the dropdown content */
function myFunction() {
    document.getElementById("myDropdown").classList.toggle("show");
}

Array.prototype.max = function() {
  return Math.max.apply(null, this);
};

function changeBar(chartType) {
        var canvas = document.getElementById("myChart") ;
        var radialChartCanvas = document.getElementById("chart") ;
        if(myChart){
            myChart.destroy() ;
        }
        d3.select('#chart').selectAll('svg').remove();


    if (chartType=='horizontalBar' || chartType=='bar' || chartType=='pie'){
        radialChartCanvas.hidden=false;
        canvas.hidden=false;
        radialBar=false ;

        if (chartType == 'pie'){
             myChart = new Chart(ctx,  {
        type: chartType,
        data:{

        labels: {{ timer_names|safe }},
        datasets: [{
            label: 'avg',
            data: {{ avg }},
            backgroundColor:"#562A72" ,
            borderColor:"#000000" ,
            borderWidth: 1
        }]
        },
        options: {
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero:true
                    }
                }],
                xAxes:[]
            }
        }
        });
        }else{myChart = new Chart(ctx,  {
        type: chartType,
        data:data ,
        options: {
            lineAtIndex:200 ,
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero:true
                    }
                }],
                xAxes:[]
            }
        }
        });
        }

    }


}

// Close the dropdown menu if the user clicks outside of it
window.onclick = function(event) {
  if (!event.target.matches('.dropbtn')) {
    var dropdowns = document.getElementsByClassName("dropdown-content");
    var i;
    for (i = 0; i < dropdowns.length; i++) {
      var openDropdown = dropdowns[i];
      if (openDropdown.classList.contains('show')) {
        openDropdown.classList.remove('show');
      }
    }
  }
}
</script>
{% endblock %}
